<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dasbor - Terproteksi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100" x-data="dashboardHandler()" x-init="checkAuth">
    
    <nav class="bg-white shadow px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-bold text-blue-600">MyDashboard</h1>
        <button @click="logout" class="text-red-500 font-medium">Keluar</button>
    </nav>

    <main class="p-8">
        <div class="bg-white p-6 rounded-lg shadow-sm inline-block">
            <h2 class="text-2xl">Halo, <span x-text="user?.displayName" class="font-bold"></span>!</h2>
            <p class="text-gray-600" x-text="user?.email"></p>
            <img :src="user?.photoURL" class="mt-4 rounded-full w-20 h-20 border">
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Gunakan config yang sama seperti di login.html
        const firebaseConfig = {

            apiKey: "AIzaSyAspWLBGshZqEgpGPKQAcpQ5Zp_PzMwI2A", // Ambil dari Firebase Settings
            authDomain: "web-login-app-e0b7d.firebaseapp.com", // Ini harus sesuai dengan URL tadi
            projectId: "web-login-app-e0b7d",
            
            storageBucket: "web-login-app-e0b7d.firebasestorage.app",
            messagingSenderId: "906196239052",
            appId: "1:906196239052:web:d29682a15abf9e0ba87869",
            measurementId: "G-Z0RS42VSW1"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        window.dashboardHandler = () => ({
            user: null,
            checkAuth() {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        this.user = user;
                    } else {
                        // Jika tidak ada user, tendang kembali ke login
                        window.location.href = 'login.html';
                    }
                });
            },
            async logout() {
                await signOut(auth);
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>